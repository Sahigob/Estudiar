<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Juego de Memoria Educativo 5x6</title>
<style>
  body {
    margin: 0; padding: 10px;
    font-family: Arial, sans-serif;
    background: #222;
    color: #eee;
    display: flex;
    flex-direction: column;
    align-items: center;
    user-select: none;
  }
  h1 {
    margin-bottom: 10px;
  }
  #gameContainer {
    width: 100vw;
    max-width: 400px;
  }
  #grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-gap: 8px;
  }
  .card {
    background-color: #444;
    border-radius: 8px;
    aspect-ratio: 1 / 1;
    cursor: pointer;
    position: relative;
    box-shadow: 0 2px 6px rgba(0,0,0,0.7);
    transition: transform 0.3s ease;
    perspective: 600px;
  }
  .card.flipped .front,
  .card.matched .front {
    transform: rotateY(0deg);
  }
  .card.flipped .back,
  .card.matched .back {
    transform: rotateY(180deg);
  }
  .card .front, .card .back {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    border-radius: 8px;
    backface-visibility: hidden;
    transition: transform 0.5s ease;
  }
  .card .front {
    background-color: #fff;
    transform: rotateY(180deg);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    color: #333;
  }
  .card .back {
    background-color: #0a74da;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    color: #fff;
    user-select:none;
  }
  #message {
    margin: 12px 0 0;
    font-size: 1.3rem;
    min-height: 1.5em;
    text-align: center;
    color: #0ff;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>Juego de Memoria 5x6</h1>
<div id="gameContainer" role="application" aria-label="Juego de memoria con 5 columnas y 6 filas">
  <div id="grid" aria-live="polite" aria-relevant="additions removals" aria-atomic="true"></div>
  <div id="message" aria-live="assertive" aria-atomic="true"></div>
</div>

<script>
(() => {
  const rows = 6;
  const cols = 5;
  const totalCards = rows * cols; // 30 cards total
  const grid = document.getElementById('grid');
  const messageElem = document.getElementById('message');

  // We need pairs, so 15 unique cards duplicated
  const uniqueSymbols = [
    'ðŸŽ','ðŸŒŸ','ðŸ¶','ðŸ€','ðŸŽˆ','ðŸš—','ðŸŒ','ðŸ±','âš½','ðŸŽµ',
    'ðŸ’Ž','ðŸŽ€','ðŸ‡','ðŸš€','ðŸŒˆ'
  ];

  // Shuffle helper
  function shuffle(array) {
    let currentIndex = array.length, randomIndex;
    while(currentIndex !== 0) {
      randomIndex = Math.floor(Math.random()*currentIndex);
      currentIndex--;
      [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
    }
    return array;
  }

  // Create deck: duplicate and shuffle
  let deck = shuffle([...uniqueSymbols, ...uniqueSymbols]);

  // State variables
  let flippedCards = [];
  let matchedCount = 0;
  let lockBoard = false;

  function createCard(symbol, index) {
    const card = document.createElement('div');
    card.classList.add('card');
    card.setAttribute('role', 'button');
    card.setAttribute('tabindex', '0');
    card.setAttribute('aria-pressed', 'false');
    card.setAttribute('aria-label', 'Carta boca abajo');
    card.dataset.symbol = symbol;
    card.dataset.index = index;

    const front = document.createElement('div');
    front.classList.add('front');
    front.textContent = symbol;

    const back = document.createElement('div');
    back.classList.add('back');
    back.innerHTML = '&#x1F0A0;'; // Playing card back symbol or similar

    card.appendChild(front);
    card.appendChild(back);

    // Click handler
    card.addEventListener('click', () => {
      if(lockBoard || card.classList.contains('flipped') || card.classList.contains('matched')) return;
      flipCard(card);
    });

    // Keyboard access: space or enter to flip
    card.addEventListener('keydown', e => {
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault();
        card.click();
      }
    });

    return card;
  }

  function flipCard(card) {
    if(flippedCards.length === 2) return;
    card.classList.add('flipped');
    card.setAttribute('aria-pressed', 'true');
    flippedCards.push(card);

    if(flippedCards.length === 2) {
      checkForMatch();
    }
  }

  function checkForMatch() {
    lockBoard = true;
    const [cardOne, cardTwo] = flippedCards;
    if(cardOne.dataset.symbol === cardTwo.dataset.symbol){
      cardOne.classList.add('matched');
      cardTwo.classList.add('matched');
      matchedCount += 2;
      setTimeout(() => {
        messageElem.textContent = `Â¡Buen trabajo! Llevas ${matchedCount/2} parejas encontradas.`;
        resetFlip();
        if(matchedCount === totalCards){
          setTimeout(() => finishGame(true), 1500);
        }
      }, 700);
    } else {
      setTimeout(() => {
        cardOne.classList.remove('flipped');
        cardTwo.classList.remove('flipped');
        cardOne.setAttribute('aria-pressed', 'false');
        cardTwo.setAttribute('aria-pressed', 'false');
        messageElem.textContent = 'IntÃ©ntalo de nuevo.';
        resetFlip();
      }, 1200);
    }
  }

  function resetFlip() {
    flippedCards = [];
    lockBoard = false;
  }

  function finishGame(won) {
    messageElem.textContent = won ? 'ðŸŽ‰ Â¡Felicidades, completaste el juego!' : 'ðŸ˜ž Juego terminado.';
    // Notifica al padre despuÃ©s de 2.5 seg
    setTimeout(() => {
      try {
        if(window.parent && typeof window.parent.endGame === 'function'){
          window.parent.endGame(won);
        } else {
          window.location.href = '/';
        }
      } catch(e) {
        window.location.href = '/';
      }
    }, 2500);
  }

  function initGame() {
    deck = shuffle([...uniqueSymbols, ...uniqueSymbols]);
    matchedCount = 0;
    lockBoard = false;
    flippedCards = [];
    messageElem.textContent = 'Selecciona dos cartas para encontrar parejas.';
    grid.innerHTML = '';
    for(let i=0; i<totalCards; i++) {
      const card = createCard(deck[i], i);
      grid.appendChild(card);
    }
  }

  // Iniciar el juego
  initGame();

})();
</script>

</body>
</html>
