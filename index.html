function endGame() {
    // 1. Detener cualquier animación de juego (si estaba en curso)
    if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
        animationFrameId = null;
    }
    
    // 2. Ocultar todos los contenedores de juego (usando la clase que añadimos: .game-container)
    // Esto asegura que el iframe y su título desaparezcan.
    document.querySelectorAll('.game-container').forEach(container => {
        container.classList.remove('active');
    });

    // 3. Ocultar la pancarta de felicitación, ya que estamos volviendo
    const rewardMessage = document.getElementById('rewardMessage');
    if (rewardMessage) {
        rewardMessage.style.display = 'none'; 
    }

    // 4. Volver a la pantalla de ejercicios y avanzar a la siguiente pregunta
    hideAllScreens();
    document.getElementById('exerciseScreen').classList.add('active');
    answeredCurrentQuestion = true; 
    nextQuestion(); 
}
